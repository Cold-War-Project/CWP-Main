namespace = aroai_preparation_events


#
# tag           : tag_aroai_preparation_events.1
# Called by     : aroai_framework_events.1
# This event is called roughly every month (it is random between aroai_days_in_the_iteration and aroai_days_in_the_iteration-6).
#
aroai_preparation_events.1 = {
    type = country_event
    hidden = yes

    trigger = {}

    immediate = {

        # Check if military expenses are higher than usual due to army being in use
        aroai_check_if_military_expenses_are_higher_than_usual = yes

        # Change tax level and government wages if needed
        aroai_manage_tax_and_wage_level = yes

        # Data gathering
        aroai_determine_highest_and_average_military_threat = yes
        aroai_determine_roleplay_building_priorities = yes
        aroai_collect_data_for_construction_and_downsizing = yes
        aroai_collect_coastlines_of_market_capital_and_overseas_lands = yes

        # Track cycles since last check of data that is used in downsizing of production buildings
        if = {
            limit = {
                OR = {
                    NOT = { has_variable = aroai_iterations_since_production_downsizing }
                    var:aroai_iterations_since_production_downsizing < aroai_max_iterations_since_production_downsizing
                }
            }
            aroai_add_to_variable = {
                name = aroai_iterations_since_production_downsizing
                value = 1
            }
        }

        # Downsizing and building share a bunch of data required for both of them to function
        if = {
            limit = {
                aroai_is_downsizing_allowed = yes
            }
            aroai_downsize_excessive_buildings = yes
            aroai_clear_downsizing_variables = yes
        }

        # Collect budget costs and restart costs collection cycle 7 days later
        aroai_perform_iteration_of_weekly_loop = {
            day_1_of_main_loop = yes
        }
    }
}